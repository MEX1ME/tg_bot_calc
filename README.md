# Привет

## Это калькулятор в телеграмм боте.

### Для установки и настройки такого бота можно воспользоваться хостингом beget.

#### Далее по пунктам алгоритм действий:


1. Заводим аккаунт на сайте beget.com
2. Регистрируем домен у регистратора доменных имен и привязываем к хостингу
3. Выпускаем для привязавшегося аккаунта SSL-сертификат

4. В настройках хостинга включаем SSH-доступ
5. Подключаемся к хостингу через SSH и оказываемся в терминале
6. Переходим в Docker при помощи команды "ssh localhost -p222"
7. Повторно вводим пароль
8. Переходим в папку сайта командой "cd tmexbot.ru". Чтобы проще ориентироваться в директориях через командную строку, используйте команды "dir" или "ls -l"
9. Создаем папку виртуального окружения командой "mkdir .venv"
10. Обновляем pip командой "python3 -m pip install --upgrade pip"
11. Активируем виртуальное окружение двумя командами: сначала "pip install pipenv", потом "pipenv shell"
12. Переходим в папку "cd .venv"
13. И выполняем "source bin/activate"
14. Необходимо выяснить адрес к директории Python, для этого выполняем: "which python3", терминал сообщит адрес установки Python, запоминаем и продолжаем
15. Устанавливаем Flask командой "python3 -m pip install flask"
16. Устанавливаем библиотеку Requests "pip install requests"
17. Если для работы вашего бота потребуются дополнительные библиотеки, или фреймворки, они устанавливаются на этом этапе
18. Перемещаемся на уровень выше по директориям "cd .."
19. Создаем две директории: "mkdir HelloFlask", "mkdir tmp"
20. И создаем два файла: "touch .htaccess" и "touch passenger_wsgi.py"
21. В файловом менеджере открываем файлы и редактируем, все ДАННЫЕ_ЗАМЕНЯЕМ_СВОИМИ:

В файле .htaccess пишем:

PassengerEnabled On
PassengerPython /home/h/ЛОГИН_К_ХОСТИНГУ/ИМЯ_ВАШЕГО_ДОМЕНА.ru/.venv/bin/python3

В файле passenger_wsgi.py пишем: 

`#` -*- coding: utf-8 -*-                                 
import sys, os

`#` указываем директорию с проектом 
sys.path.append('/home/ВАША_БУКВА/ЛОГИН_К_ХОСТИНГУ/ИМЯ_ВАШЕГО_ДОМЕНА.ru/HelloFlask') 

`#` указываем директорию с библиотеками, куда поставили Flask
sys.path.append('/home/ВАША_БУКВА/ЛОГИН_К_ХОСТИНГУ/.local/lib/python3.6/site-packages') 

from HelloFlask import app as application
`#` Когда Flask стартует, он ищет application. 
`#` Если не указать 'as application', сайт не заработает

from werkzeug.debug import DebuggedApplication
`#` Опционально: подключение модуля отладки 

application.wsgi_app = DebuggedApplication(application.wsgi_app, False)
`#` Опционально: включение модуля отадки

application.debug = False
`#` Опционально: True/False устанавливается по необходимости в отладке 

22. В файловом менеджере хостинга устанавляваем права доступа 644 к обоим файлам через пункт меню "Изменить аттрибуты"

23. Переходим в папку "cd HelloFlask"
24. Создаем там файлы `__init__.py`, module.py и config.py командами "touch `__init__.py`", "touch module.py" и "touch config.py"
25. В файлы module.py и config.py соответственно помещается код из файлова репозитория
26. В файле config.py должен находиться ваш токен телеграмм бота в формате API_TOKEN = "ВАШ_ТОКЕН"
27. Обратите внимание на строку "@app.route("/python-bot/", methods=["GET", "POST"])", адрес "/python-bot/" используется в дальнейшем при регистрации вебхука
28. СОхраняем файлы и также устанавливаем права "644"
29. Возвращаемся в корневую директорию "cd .."
30. И выполняем: "ln -s public_html public"
31. Для перезапуска приложения Flask и вашего бота вводите в терминал "touch tmp/restart.txt". Если вносите какие-то изменения в код, то потребуется перезапускать бота этой еомандой
32. Теперь если перейти по адресу "https://ВАШ_ДОМЕН.ru/python-bot", увидите текстовое сообщение из этой строки "return "<`h1`>Приветствую, странник. Переходи на qmex.ru. Только там Все ответы.</`h1`>"", в своем браузере
33. И активируем вебхук открыв страницу в браузере: "https://api.telegram.org/botТОКЕН_БОТА/setWebhook?url=https://ИМЯ_ВАШЕГО_ДОМЕНА.ru/python-bot/". Если все ок, увидим "ok: true, result: true, description: webhook was set"

Можно проверить как работает сам бот. При правильном и внимательном выполнении всех команд, все должно заработать с первого раза. Удачи.